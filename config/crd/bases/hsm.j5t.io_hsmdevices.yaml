---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: hsmdevices.hsm.j5t.io
spec:
  group: hsm.j5t.io
  names:
    kind: HSMDevice
    listKind: HSMDeviceList
    plural: hsmdevices
    shortNames:
    - hsmdev
    singular: hsmdevice
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.deviceType
      name: Type
      type: string
    - jsonPath: .spec.discovery.autoDiscovery
      name: Discovery
      type: string
    - jsonPath: .spec.maxDevices
      name: Max Devices
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: HSMDevice is the Schema for the hsmdevices API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: HSMDeviceSpec defines the desired state of HSMDevice.
            properties:
              deviceType:
                description: DeviceType specifies the type of HSM device
                type: string
              discovery:
                description: Discovery defines how to discover this HSM device
                properties:
                  autoDiscovery:
                    default: false
                    description: AutoDiscovery enables automatic discovery based on
                      device type
                    type: boolean
                  devicePath:
                    description: DevicePath defines path-based device discovery criteria
                    properties:
                      path:
                        description: Path is the device path pattern (e.g., "/dev/ttyUSB*",
                          "/dev/sc-hsm*")
                        type: string
                      permissions:
                        description: Permissions are the required permissions for
                          device access
                        type: string
                    required:
                    - path
                    type: object
                  usb:
                    description: USB defines USB-based device discovery criteria
                    properties:
                      productId:
                        description: ProductID is the USB product ID (e.g., "4230"
                          for Pico HSM)
                        type: string
                      serialNumber:
                        description: SerialNumber optionally matches a specific device
                          serial number
                        type: string
                      vendorId:
                        description: VendorID is the USB vendor ID (e.g., "20a0" for
                          Pico HSM)
                        type: string
                    required:
                    - productId
                    - vendorId
                    type: object
                type: object
              maxDevices:
                default: 10
                description: MaxDevices limits how many instances of this device can
                  be discovered
                format: int32
                type: integer
              mirroring:
                description: Mirroring configures cross-node device mirroring for
                  high availability
                properties:
                  autoFailover:
                    default: true
                    description: AutoFailover enables automatic failover to healthy
                      nodes
                    type: boolean
                  policy:
                    default: None
                    description: Policy specifies the mirroring strategy
                    type: string
                  primaryNode:
                    description: PrimaryNode specifies the preferred primary node
                      for write operations
                    type: string
                  syncInterval:
                    default: 60
                    description: SyncInterval defines how often to sync device data
                      across nodes (in seconds)
                    format: int32
                    type: integer
                  targetNodes:
                    description: |-
                      TargetNodes specifies nodes that should have mirrored access
                      If empty, mirrors to all nodes with the device
                    items:
                      type: string
                    type: array
                type: object
              nodeSelector:
                additionalProperties:
                  type: string
                description: NodeSelector specifies which nodes should be scanned
                  for this device
                type: object
              pkcs11:
                description: PKCS11 defines PKCS#11 connection configuration for this
                  device
                properties:
                  libraryPath:
                    description: LibraryPath is the path to the PKCS#11 library for
                      this device
                    type: string
                  pinSecret:
                    description: PinSecret references a Kubernetes Secret containing
                      the HSM PIN
                    properties:
                      key:
                        description: Key is the key within the secret
                        type: string
                      name:
                        description: Name is the name of the secret
                        type: string
                      namespace:
                        description: Namespace is the namespace of the secret (optional,
                          defaults to HSMDevice namespace)
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  slotId:
                    default: 0
                    description: SlotId is the PKCS#11 slot ID to use for this device
                    format: int32
                    type: integer
                  tokenLabel:
                    description: TokenLabel optionally specifies the token label to
                      match
                    type: string
                type: object
            required:
            - deviceType
            type: object
        type: object
    served: true
    storage: true
    subresources: {}
