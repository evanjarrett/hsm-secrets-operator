<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSM Secrets Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔐 HSM Secrets Manager</h1>
            <p>Manage your Hardware Security Module secrets through a simple web interface</p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalSecrets">-</div>
                <div class="stat-label">Total Secrets</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiStatus">-</div>
                <div class="stat-label">API Status</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="deviceCount">-</div>
                <div class="stat-label">HSM Devices</div>
            </div>
        </div>

        <div class="section" id="deviceSection">
            <h2>🔌 HSM Device Status</h2>
            <div class="toolbar">
                <button class="btn btn-secondary" onclick="refreshDeviceStatus()">🔄 Refresh Devices</button>
                <button class="btn btn-secondary" onclick="refreshAll()">🔄 Refresh All</button>
            </div>
            <div id="deviceStatus" class="device-status">
                <div class="loading">Loading device status...</div>
            </div>
        </div>

        <div class="section">
            <h2>📋 Secrets List</h2>
            <div class="toolbar">
                <button class="btn btn-secondary" onclick="refreshSecrets()">🔄 Refresh</button>
                <button class="btn" onclick="showCreateForm()">➕ Create New Secret</button>
            </div>
            <div id="secretsList" class="secrets-list">
                <div class="loading">Loading secrets...</div>
            </div>
        </div>

        <div class="section" id="createSection" style="display: none;">
            <h2>➕ Create New Secret</h2>
            <div id="createMessage"></div>
            <form id="createForm">
                <div class="form-group">
                    <label for="secretName">Secret Name</label>
                    <input type="text" id="secretName" name="secretName" placeholder="e.g., my-app-secrets" required>
                </div>
                
                <div class="form-group">
                    <label>Secret Data</label>
                    <div class="kv-container">
                        <div class="kv-header">
                            <span>Key-Value Pairs</span>
                            <button type="button" class="btn btn-add btn-small" onclick="ui.addKeyValuePair()" title="Add new key-value pair">
                                ➕
                            </button>
                        </div>
                        <div id="kvPairs">
                            <!-- Initial key-value pair will be added by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="advanced-section">
                    <button type="button" class="advanced-toggle" onclick="ui.toggleAdvanced()">
                        <span>🔧 Advanced Metadata (Optional)</span>
                        <span class="arrow">▼</span>
                    </button>
                    <div id="advancedContent" class="advanced-content">

                        <div class="metadata-field">
                            <label for="metadataDescription">Description</label>
                            <textarea id="metadataDescription" name="metadataDescription" placeholder="Description of this secret's purpose"></textarea>
                        </div>

                        <div class="metadata-field">
                            <label for="metadataFormat">Format</label>
                            <input type="text" id="metadataFormat" name="metadataFormat" placeholder="e.g., json, yaml, text">
                        </div>

                        <div class="metadata-field">
                            <label for="metadataDataType">Data Type</label>
                            <input type="text" id="metadataDataType" name="metadataDataType" placeholder="e.g., credentials, config, certificate">
                        </div>

                        <div class="metadata-field">
                            <label for="metadataSource">Source</label>
                            <input type="text" id="metadataSource" name="metadataSource" placeholder="Source system or application">
                        </div>

                        <div class="metadata-field">
                            <label>Labels</label>
                            <div class="tags-container">
                                <div class="tags-header">
                                    <span>Kubernetes Labels (will be applied to Secret)</span>
                                    <button type="button" class="btn btn-add btn-small" onclick="ui.addLabelPair()" title="Add new label">
                                        ➕
                                    </button>
                                </div>
                                <div id="labelPairs">
                                    <!-- Label pairs will be added by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn">Create Secret</button>
                    <button type="button" class="btn btn-secondary" onclick="hideCreateForm()">Cancel</button>
                </div>
            </form>
        </div>

        <div class="section" id="viewSection" style="display: none;">
            <h2>🔍 Secret Details</h2>
            <div id="viewMessage"></div>
            <div id="secretDetails"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="hideViewSection()">Close</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>